# Public Transport Networks

Networks of the public transport metro systems in Munich, London, Sydney, and Paris.

## Overview

The networks are provided as either undirected or directed multigraphs. The data associated with every node includes the station name as well as the station's coordinates and state. In addition, the data associated with every edge includes the line and (as for the nodes) its state.

The networks have been compiled from resources made publicly available by the public transport providers in the corresponding cities. The networks reflect the current state (January 2022) of the metro systems and do not include stations and lines that are currently planned or under construction. The coordinates for the stations have been extracted from the OpenStreetMap database.

Note that even though two lines might intersect at the same station, they might use different platforms e.g. on different levels. The networks provided here do not respect these subtleties since they are not relevant for many practical purposes.

## Data processing

### Generating subnetwork by an edge attribute

Sometimes it might be desirable to consider only subnetworks generated by a subset of the transport lines. In these cases, one wants to remove every edge that does not have a certain attribute or that has the attribute but its value is not in a certain range.

This can be achieved as follows:

```python
import networkx as nx

def SubMultiGraph_by_Attribute(G, a, values, remove_isolates=True):
    """
    Generate a subgraph of multi-(di)graph based on an edge attribute.
    
    Parameters
    ----------
    G : networkx.MultiGraph or networkx.MultiDiGraph
        Input multigraph, either undirected or directed.
    a : str
        Edge attribute name.
    values : list of ?
        Possible attribute values.
    remove_isolates : bool
        Remove isolated nodes from subgraph. Default is True.
        
    Returns
    -------
    _ : networkx.MultiGraph or networkx.MultiDiGraph
        Subgraph.
        
    Example
    -------
    >>> G = nx.MultiDiGraph()
    >>> G.add_edges_from([(1, 2, {'line': 'A'}), (2, 1, {'line': 'A'}), (1, 2, {'line': 'B'}), (2, 3, {'line': 'B'})]);
    >>>
    >>> SubMultiGraph_by_Attribute(G, 'line', ['A'])
    """
    
    if not isinstance(values, list):
        values = [values]
    
    _G = G.copy()
    
    for *e, k, attributes in G.edges(data=True, keys=True):
        if a not in attributes or attributes[a] not in values:
            _G.remove_edge(*e, key=k)
    
    if remove_isolates:
        _G.remove_nodes_from(list(nx.isolates(_G)))
                
    return _G


G = nx.freeze(SubMultiGraph_by_Attribute(nx.read_graphml('/path/to/city-metro.graphml'), 'line', [ ... ]))
```

### Collapsing multiple edges between two nodes onto a single weighted edge 

Sometimes distinguishing between the edges corresponding to different lines is not necessary or desired. In these cases, one might want to collapse the multiple edges between two nodes onto a single weighted edge.

This can be achieved as follows:

```python
import networkx as nx

def MultiGraph_to_Graph(G):
    """
    Transforms a multi-(di)graph into a (di)graph by collapsing multiple edges
    between two nodes onto a single weighted edge.
    
    Parameters
    ----------
    G : networkx.MultiGraph or networkx.MultiDiGraph
        Input multigraph, either undirected or directed.
        
    Returns
    -------
    _ : networkx.Graph or networkx.DiGraph
        Weighted graph, either undirected or directed depending on the input
        multigraph.
        
    Example
    -------
    >>> G = nx.MultiDiGraph()
    >>> G.add_edges_from([(1, 2, {'line': 'A'}), (2, 1, {'line': 'A'}), (1, 2, {'line': 'B'}), (2, 3, {'line': 'B'})]);
    >>>
    >>> MultiGraph_to_Graph(G)
    """

    if G.is_directed():
        _G = nx.DiGraph(G)
    else:
        _G = nx.Graph(G)
    _G.clear_edges()
    
    for e in G.edges():
        if not _G.has_edge(*e):
            _G.add_edge(*e, weight=1)
        else:
            _G.edges[e]['weight'] += 1
            
    return _G


G = nx.freeze(MultiGraph_to_Graph(nx.read_graphml('/path/to/city-metro.graphml')))
```

## References

* OpenSteetMap Foundation (OSMF) OpenStreetMap": [https://www.openstreetmap.org](https://www.openstreetmap.org)
* Münchner Verkehrs- und Tarifverbund GmbH (MVV): [https://www.mvv-muenchen.de/fahrplanauskunft/](https://www.mvv-muenchen.de/fahrplanauskunft/)
* Transport for London: [https://tfl.gov.uk/travel-information/stations-stops-and-piers/](https://tfl.gov.uk/travel-information/stations-stops-and-piers/)
* Transport for NSW / Sydney Train: [https://transportnsw.info/routes/train](https://transportnsw.info/routes/train)
* Régie autonome des transports Parisiens (RATP): [https://www.ratp.fr/en/vos-lignes](https://www.ratp.fr/en/vos-lignes)
